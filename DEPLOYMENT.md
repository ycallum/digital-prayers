# Deployment Guide - Digital Prayer Beads (电子念珠)

## Prerequisites

- Node.js 18+ or Bun runtime
- npm or bun package manager

## Pre-Deployment Checklist

### 1. Environment Variables

Copy `.env.example` to `.env` and configure:

```bash
cp .env.example .env
```

Currently, the app runs entirely client-side with no backend requirements. If you integrate Supabase in the future, add the appropriate credentials.

### 2. Build Verification

Run the verification script to ensure code quality:

```bash
npm run verify
```

This command runs:
- TypeScript type checking
- ESLint code quality checks
- Production build

### 3. Production Build

Create an optimized production build:

```bash
npm run build:prod
```

The build output will be in the `dist/` directory.

## Deployment Platforms

### Vercel (Recommended)

1. **Install Vercel CLI**:
```bash
npm i -g vercel
```

2. **Deploy**:
```bash
vercel --prod
```

3. **Configuration**: Vercel auto-detects Vite projects. No additional configuration needed.

### Netlify

1. **Install Netlify CLI**:
```bash
npm i -g netlify-cli
```

2. **Deploy**:
```bash
netlify deploy --prod --dir=dist
```

3. **Build Settings**:
   - Build command: `npm run build:prod`
   - Publish directory: `dist`

### Cloudflare Pages

1. Connect your GitHub repository to Cloudflare Pages

2. **Build Settings**:
   - Build command: `npm run build:prod`
   - Build output directory: `dist`
   - Root directory: `/`

### Static Hosting (GitHub Pages, S3, etc.)

1. **Build the project**:
```bash
npm run build:prod
```

2. **Upload `dist/` contents** to your hosting provider

3. **Configure SPA routing**: Ensure your hosting serves `index.html` for all routes

## PWA Configuration

The app is configured as a Progressive Web App with:

- **Service Worker**: Auto-generated by Vite PWA plugin
- **Manifest**: `/manifest.webmanifest`
- **Offline Support**: Full offline functionality via service worker caching
- **Assets Cached**: All JS, CSS, HTML, audio files (mp3, wav), images (png, svg)

### PWA Verification

After deployment, verify PWA functionality:

1. Open Chrome DevTools → Application tab
2. Check "Service Workers" section
3. Verify "Manifest" is loaded correctly
4. Test offline mode by toggling network offline

## Build Outputs

Production build generates:

- `dist/index.html` - Main HTML file
- `dist/assets/` - Optimized JS and CSS bundles
- `dist/manifest.webmanifest` - PWA manifest
- `dist/sw.js` - Service worker for offline support
- `dist/registerSW.js` - Service worker registration script
- `dist/sounds/` - Audio files (if present)
- `dist/icons/` - App icons for PWA

## Performance Optimization

The build is optimized with:

- **Code Splitting**: Automatic vendor and component splitting
- **Tree Shaking**: Unused code elimination
- **Minification**: JS and CSS minification
- **Compression**: Gzip compression enabled
- **Asset Optimization**: Image and font optimization

### Bundle Analysis

To analyze bundle size:

```bash
npm run build -- --report
```

## Post-Deployment

### 1. Verify Build

```bash
npm run preview
```

Test the production build locally before deploying.

### 2. Test PWA Installation

On mobile or desktop:
- Chrome: Look for install prompt or "+" icon in address bar
- Safari: Share → Add to Home Screen

### 3. Monitor Performance

- Use Lighthouse in Chrome DevTools
- Target scores: Performance 90+, Accessibility 90+, Best Practices 90+, SEO 90+

## Troubleshooting

### Build Fails

```bash
# Clean install dependencies
rm -rf node_modules package-lock.json
npm install

# Verify code quality
npm run typecheck
npm run lint
```

### PWA Not Working

- Verify HTTPS is enabled (required for service workers)
- Check browser console for service worker errors
- Ensure `manifest.webmanifest` is accessible
- Clear browser cache and re-register service worker

### Assets Not Loading

- Check `vite.config.ts` base path configuration
- Verify all asset paths are relative or absolute from root
- Ensure public assets are in `public/` directory

## Security Best Practices

- ✅ No sensitive data in environment variables exposed to client
- ✅ All dependencies are up-to-date
- ✅ CSP headers configured (configure at hosting level)
- ✅ HTTPS enforced for PWA functionality

## Continuous Deployment

### GitHub Actions Example

```yaml
name: Deploy

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: npm run verify
      - run: npm run build:prod
      # Add deployment step for your platform
```

## Maintenance

### Update Dependencies

```bash
# Check for outdated packages
npm outdated

# Update dependencies
npm update

# Re-verify build
npm run verify
```

### Monitor Build Size

Keep bundle size under control:
- Main bundle: < 350KB
- Total assets: < 500KB
- Lighthouse Performance: 90+

## Support

For issues or questions:
- Check GitHub Issues
- Review build logs for specific errors
- Verify all prerequisites are met
